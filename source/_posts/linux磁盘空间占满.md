---
title: 分析linux磁盘空间占满问题
date: 2017-12-13 19:38:01
tags: 
    - 笔记
---

ONAP Amsterdam版本环境，MSO所在虚拟机320G硬盘被占满，``/``根目录可用空间为0，故需定位垃圾文件位置
思路：利用``du``命令，分析目录下空间占用，在顺着文件树逐步查找
若是无法确定是哪个目录下的空间占用过大，可以从``/``目录开始追溯
<!-- more -->
```
cd /
du -sh *
```
接下来，切换到空间占用异常的目录下，如``/var``
```
# 由于文件占用过大，粗暴的以g为单位查找空间大小，并降序排列
du --block-size=1g --max-depth=1|sort -gr
```
重复上述步骤，直到基本定位到文件所在位置。

最终，发现是docker容器的日志文件写入异常，导致文件达到了近300G
利用truncate命令截断该日志文件
``truncate -s 0 /var/lib/docker/containers/xxx/*-json.log``

### PS
有些情况下，文件被占用无法删除，却不知道是哪个进程干的，需要利用``lsof |grep delete``定位进程，进而``kill -9``进程。

